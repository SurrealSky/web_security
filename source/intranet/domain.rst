域渗透
========================================

域
----------------------------------------
域指将网络中多台计算机逻辑上组织到一起，进行集中管理的逻辑环境。域是组织与存储资源的核心管理单元，在域中，至少有一台域控制器，域控制器中保存着整个域的用户帐号和安全数据库。

判断是否有域
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
一般域服务器都会同时作为时间服务器，所以使用下面命令判断主域
::

	1.存在域，但当前用户不是域用户，提示说明权限不够
		C:\Users>bypass>net time /domain
		发生系统错误 5 
		拒绝访问。

	2.存在域，并且当前用户是域用户
		C:\Users\Administrator>net time /domain
		\\dc.test.com 的当前时间是 2020/10/23 21:18:37
		
		命令成功完成。

	3.当前网络环境为工作组，不存在域
		C:\Users\Administrator>net time /domain
		找不到域 WORKGROUP 的域控制器。

查找域管理员
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
::

	net user /domain //获取域用户列表
	net group /domain  //查询域内所有用户组列表
	net group “Domain Admins” /domain //查询域管理员用户
	net group "Domain Controllers" /domain  //查看域控制器
	net localgroup administrators /domain  //查询域内置本地管理员组用户

找到域控
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
一般来说，域控服务器IP地址为DNS服务器地址，找到DNS服务器地址就可以定位域控。
::

	nslookup/ping 域名,解析到域控服务器IP地址

Active Directory
----------------------------------------
活动目录（AD）是面向Windows Server的目录服务。Active Directory存储了有关网络对象的信息，并且让管理员和用户能够查找和使用这些信息。

NTLM认证
----------------------------------------
NTLM是NT LAN Manager的缩写，NTLM是基于挑战/应答的身份验证协议，是 Windows NT 早期版本中的标准安全协议，基本流程为：

- 客户端在本地加密当前用户的密码成为密码散列
- 客户端向服务器明文发送账号
- 服务器端产生一个16位的随机数字发送给客户端，作为一个challenge
- 客户端用加密后的密码散列来加密challenge，然后返回给服务器，作为response
- 服务器端将用户名、challenge、response发送给域控制器
- 域控制器用这个用户名在SAM密码管理库中找到这个用户的密码散列，然后使用这个密码散列来加密chellenge
- 域控制器比较两次加密的challenge，如果一样那么认证成功，反之认证失败

kerboser认证
----------------------------------------
见认证机制章中Kerberos一节。

Pass The Hash
----------------------------------------
Pass The Hash (PtH) 是攻击者捕获帐号登录凭证后，复用凭证Hash进行攻击的方式。

Pass The Key
----------------------------------------
