网站真实IP追踪
========================================

内容分发网络(CDN)
-----------------------------------------
 | 内容分发网络(content delivery network或content distribution network，缩写作CDN)指一种通过互联网互相连接的电脑网络系统，利用最靠近每位用户的服务器，更快、更可靠地将音乐、图片、视频、应用程序及其他文件发送给用户，来提供高性能、可扩展性及低成本的网络内容传递给用户。
 | CDN节点会在多个地点，不同的网络上摆放。这些节点之间会动态的互相传输内容，对用户的下载行为最优化，并借此减少内容供应者所需要的带宽成本，改善用户的下载速度，提高系统的稳定性。国内常见的CDN有ChinanNet Center（网宿科技）、ChinaCache（阿里云）等，国外常见的有Akamai(阿卡迈)、Limelight Networks（简称LLNW）等；

 | 如图：用户先经由CDN节点，然后再访问web服务器。
	|cdn|

判断ip是否是网站真实ip
-----------------------------------------

Nslookup法
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
一般nslookup想要查的域名，若是有多个ip就是用了cdn，多半为假ip。

多地ping域名法
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
可以从多个地点ping他们想要确认的域名，若返回的是不同的ip，那么服务器确定使用了cdn，返回的ip也不是服务器的真实ip。

“常识”判断法
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
- 在反查网站ip时，如果此网站有1000多个不同域名，那么这个ip多半不是真实ip。
- 如果一个asp或者asp.net网站返回的头字段的server不是IIS、而是Nginx，那么多半是用了nginx反向代理，而不是真实ip。
- 如果ip定位是在常见cdn服务商的服务器上，那么是真实ip的可能性就微乎其微了。


如何寻找真实ip
-----------------------------------------

子域名查找法
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
因为cdn和反向代理是需要成本的，有的网站只在比较常用的域名使用cdn或反向代理，有的时候一些测试子域名和新的子域名都没来得及加入cdn和反向代理，所以有时候是通过查找子域名来查找网站的真实IP。

ip历史记录解析查询法
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
有的网站是后来才加入CDN的，所以只需查询它的解析历史即可获取真实ip。

网站漏洞查找法
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
通过网站的信息泄露如phpinfo泄露，github信息泄露，命令执行等漏洞获取真实ip。

网站订阅邮件法
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
通过网站订阅邮件的功能，让网站给自己发邮件，查看邮件的源代码即可获取网站真实ip。

理想zmap法
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
首先从 apnic 网络信息中心获取ip段，然后使用Zmap的 banner-grab 对扫描出来 80 端口开放的主机进行banner抓取，最后在 http-req中的Host写我们需要寻找的域名，然后确认是否有相应的服务器响应。

网络空间引擎搜索法
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
常见的有以前的钟馗之眼，shodan(https://www.shodan.io/)，fofa搜索(https://fofa.so/)。以fofa为例，只需输入：title:“网站的title关键字”或者body：“网站的body特征”就可以找出fofa收录的有这些关键字的ip域名，很多时候能获取网站的真实ip。

F5 LTM解码法
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
当服务器使用F5 LTM做负载均衡时，通过对set-cookie关键字的解码真实ip也可被获取，例如：Set-Cookie: BIGipServerpool_8.29_8030=487098378.24095.0000，先把第一小节的十进制数即487098378取出来，然后将其转为十六进制数1d08880a，接着从后至前，以此取四位数出来，也就是0a.88.08.1d，最后依次把他们转为十进制数10.136.8.29，也就是最后的真实ip。

 .. |cdn| image:: ../../images/cdn.jpg