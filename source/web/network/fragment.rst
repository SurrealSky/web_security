数据分片
========================================

最大传输单元(MTU)
---------------------------------------------

数据链路层传输的帧大小是有限制的，以太网和IEEE 802.3对数据帧的长度都有一个限制，不能把一个太大的包直接塞给链路层，这个限制被称为最大传输单元(Maximum Transmission Unit，MTU)。

以太网的帧最小为64字节，最大为1518字节。除去14字节头部和4字节 CRC字段，最小的有效载荷为46字节，最大的有效载荷为1500字节这个值就是MTU。就是说传输100KB的数据，至少需要发送69次以太网的贞。

不同的数据链路层的MTU也是不同的，IP协议的数据报最大为65535个字节，如果开启了巨型贞(Jumbo Frame)能达到9000个字节。这远超出了MTU的值，所以当IP数据报大于MTU的时候，此时IP层就需要对数据进行分片，否则数据就无法发送成功。


TCP最大报文段长度（MSS）
-------------------------------------------

TCP为了避免被发送方分片，它主动把数据分成小段再交给网络层。最大的分段大小称为MSS（Maximum Segment Size），它相当于把MTU刨去IP头和TCP头之后的大小，所以一个MSS恰好能装进一个MTU中。

以太网贞是1500字节+14字节的MAC头，TCP头一共是32个字节，可选项占了12字节。所以TCP的MSS=1500-20-20-12=1448字节。

UDP协议没有MSS的概念，传输层的数据可能一股脑的交给网络层，所以数据可能会被分片而影响性能。假设用 UDP 协议发送数据，那么如果网络发生了波动，丢失了某个IP包分片，对于UDP而言，它没有反馈丢失了哪个分片给发送方的能力，这就意味着：50k（假设客户端一次发送数据包大小）的数据全都丢失了，如果需要重传，就得再次完整的传递这50k的数据。

在三次握手的时候接收方和发送方都会声明自己MSS，因为接收方和发送方的MTU可能是不同的，最终会以较小的MSS为准。

思考
-------------------------------------------
既然最大IP报文长度为65536字节，为何要把互联网路由器接口的MTU限制为1500字节？
