

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>10.3. 流量相关 &mdash; Web安全技术栈 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="10.4. 嗅探工具" href="sniffing.html" />
    <link rel="prev" title="10.2. 下载工具" href="download.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Web安全技术栈
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">内容索引:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../basic/index.html">1. 序章</a></li>
<li class="toctree-l1"><a class="reference internal" href="../network/index.html">2. 计算机网络与协议</a></li>
<li class="toctree-l1"><a class="reference internal" href="../info/index.html">3. 信息收集</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vuln/index.html">4. 常见漏洞攻防</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/index.html">5. 语言与框架</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intranet/index.html">6. 内网渗透</a></li>
<li class="toctree-l1"><a class="reference internal" href="../defense/index.html">7. 防御技术</a></li>
<li class="toctree-l1"><a class="reference internal" href="../auth/index.html">8. 认证机制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">9. 工具与资源</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">10. 手册速查</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="brute.html">10.1. 爆破工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="download.html">10.2. 下载工具</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">10.3. 流量相关</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tcpdump">10.3.1. TCPDump</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">10.3.1.1. 命令行常用选项</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#bro">10.3.2. Bro</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">10.3.2.1. 命令行</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">10.3.2.2. 脚本</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tcpflow">10.3.3. tcpflow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">10.3.3.1. 命令行常用选项</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#tshark">10.3.4. tshark</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">10.3.4.1. 输入接口</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">10.3.4.2. 捕获停止选项</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">10.3.4.3. 处理选项</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">10.3.4.4. 输出选项</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">10.3.4.5. 其他选项</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sniffing.html">10.4. 嗅探工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="sqlmap.html">10.5. SQLMap使用</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../misc/index.html">11. 其他</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Web安全技术栈</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html"><span class="section-number">10. </span>手册速查</a> &raquo;</li>
        
      <li><span class="section-number">10.3. </span>流量相关</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/manual/traffic.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1><span class="section-number">10.3. </span>流量相关<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="tcpdump">
<h2><span class="section-number">10.3.1. </span>TCPDump<a class="headerlink" href="#tcpdump" title="Permalink to this headline">¶</a></h2>
<p>TCPDump是一款数据包的抓取分析工具，可以将网络中传送的数据包的完全截获下来提供分析。它支持针对网络层、协议、主机、网络或端口的过滤，并提供逻辑语句来过滤包。</p>
<div class="section" id="id2">
<h3><span class="section-number">10.3.1.1. </span>命令行常用选项<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-B</span> <span class="pre">&lt;buffer_size&gt;</span></code> 抓取流量的缓冲区大小，若过小则可能丢包，单位为KB</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">&lt;count&gt;</span></code> 抓取n个包后退出</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-C</span> <span class="pre">&lt;file_size&gt;</span></code> 当前记录的包超过一定大小后，另起一个文件记录，单位为MB</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;interface&gt;</span></code> 指定抓取网卡经过的流量</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-n</span></code> 不转换地址</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">&lt;file&gt;</span></code> 读取保存的pcap文件</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">&lt;snaplen&gt;</span></code> 从每个报文中截取snaplen字节的数据，0为所有数据</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-q</span></code> 输出简略的协议相关信息，输出行都比较简短。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-W</span> <span class="pre">&lt;cnt&gt;</span></code> 写满cnt个文件后就不再写入</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-w</span> <span class="pre">&lt;file&gt;</span></code> 保存流量至文件</dt><dd><ul>
<li><p>按时间分包时，可使用strftime的格式命名，例如 <code class="docutils literal notranslate"><span class="pre">%Y_%m_%d_%H_%M_%S.pcap</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-G</span> <span class="pre">&lt;seconds&gt;</span></code> 按时间分包</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-v</span></code> 产生详细的输出，<code class="docutils literal notranslate"><span class="pre">-vv</span></code> <code class="docutils literal notranslate"><span class="pre">-vvv</span></code> 会产生更详细的输出</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-X</span></code> 输出报文头和包的内容</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-Z</span> <span class="pre">&lt;user&gt;</span></code> 在写文件之前，转换用户</p></li>
</ul>
</div>
</div>
<div class="section" id="bro">
<h2><span class="section-number">10.3.2. </span>Bro<a class="headerlink" href="#bro" title="Permalink to this headline">¶</a></h2>
<p>Bro是一个开源的网络流量分析工具，支持多种协议，可实时或者离线分析流量。</p>
<div class="section" id="id3">
<h3><span class="section-number">10.3.2.1. </span>命令行<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>实时监控 <code class="docutils literal notranslate"><span class="pre">bro</span> <span class="pre">-i</span> <span class="pre">&lt;interface&gt;</span> <span class="pre">&lt;list</span> <span class="pre">of</span> <span class="pre">script</span> <span class="pre">to</span> <span class="pre">load&gt;</span></code></p></li>
<li><p>分析本地流量 <code class="docutils literal notranslate"><span class="pre">bro</span> <span class="pre">-r</span> <span class="pre">&lt;pcapfile&gt;</span> <span class="pre">&lt;scripts...&gt;</span></code></p></li>
<li><p>分割解析流量后的日志 <code class="docutils literal notranslate"><span class="pre">bro-cut</span></code></p></li>
</ul>
</div>
<div class="section" id="id4">
<h3><span class="section-number">10.3.2.2. </span>脚本<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>为了能够扩展和定制Bro的功能，Bro提供了一个事件驱动的脚本语言。</p>
</div>
</div>
<div class="section" id="tcpflow">
<h2><span class="section-number">10.3.3. </span>tcpflow<a class="headerlink" href="#tcpflow" title="Permalink to this headline">¶</a></h2>
<p>tcpflow也是一个抓包工具，它的特点是以流为单位显示数据内容，在分析HTTP等协议的数据时候，用tcpflow会更便捷。</p>
<div class="section" id="id5">
<h3><span class="section-number">10.3.3.1. </span>命令行常用选项<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-b</span> <span class="pre">max_bytes</span></code> 定义最大抓取流量</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">name</span></code> 指定解析的scanner</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">interface</span></code> 指定抓取接口</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">outputdir</span></code> 指定输出文件夹</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">file</span></code> 读取文件</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-R</span> <span class="pre">file</span></code> 读取文件，但是只读取完整的文件</p></li>
</ul>
</div>
</div>
<div class="section" id="tshark">
<h2><span class="section-number">10.3.4. </span>tshark<a class="headerlink" href="#tshark" title="Permalink to this headline">¶</a></h2>
<p>WireShark的命令行工具，可以通过命令提取自己想要的数据，可以重定向到文件，也可以结合上层语言来调用命令行，实现对数据的处理。</p>
<div class="section" id="id6">
<h3><span class="section-number">10.3.4.1. </span>输入接口<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;interface&gt;</span></code> 指定捕获接口，默认是第一个非本地循环接口</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">&lt;capture</span> <span class="pre">filter&gt;</span></code> 设置抓包过滤表达式，遵循libpcap过滤语法，这个选项在抓包的过程中过滤，如果是分析本地文件则用不到</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">&lt;snaplen&gt;</span></code> 设置快照长度，用来读取完整的数据包，因为网络中传输有65535的限制，值0代表快照长度65535，默认为65535</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-p</span></code> 以非混合模式工作，即只关心和本机有关的流量</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-B</span> <span class="pre">&lt;buffer</span> <span class="pre">size&gt;</span></code> 设置缓冲区的大小，只对windows生效，默认是2M</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span> <span class="pre">&lt;link</span> <span class="pre">type&gt;</span></code> 设置抓包的数据链路层协议，不设置则默认为 <code class="docutils literal notranslate"><span class="pre">-L</span></code> 找到的第一个协议</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-D</span></code> 打印接口的列表并退出</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-L</span></code> 列出本机支持的数据链路层协议，供-y参数使用。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">&lt;infile&gt;</span></code> 设置读取本地文件</p></li>
</ul>
</div>
<div class="section" id="id7">
<h3><span class="section-number">10.3.4.2. </span>捕获停止选项<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">&lt;packet</span> <span class="pre">count&gt;</span></code> 捕获n个包之后结束，默认捕获无限个</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">-a</span> <span class="pre">&lt;autostop</span> <span class="pre">cond&gt;</span></code></dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">duration:NUM</span></code> 在num秒之后停止捕获</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filesize:NUM</span></code> 在numKB之后停止捕获</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">files:NUM</span></code> 在捕获num个文件之后停止捕获</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id8">
<h3><span class="section-number">10.3.4.3. </span>处理选项<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-Y</span> <span class="pre">&lt;display</span> <span class="pre">filter&gt;</span></code> 使用读取过滤器的语法，在单次分析中可以代替 <code class="docutils literal notranslate"><span class="pre">-R</span></code> 选项</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-n</span></code> 禁止所有地址名字解析（默认为允许所有）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-N</span></code> 启用某一层的地址名字解析。 <code class="docutils literal notranslate"><span class="pre">m</span></code> 代表MAC层， <code class="docutils literal notranslate"><span class="pre">n</span></code> 代表网络层， <code class="docutils literal notranslate"><span class="pre">t</span></code> 代表传输层， <code class="docutils literal notranslate"><span class="pre">C</span></code> 代表当前异步DNS查找。如果 <code class="docutils literal notranslate"><span class="pre">-n</span></code> 和 <code class="docutils literal notranslate"><span class="pre">-N</span></code> 参数同时存在， <code class="docutils literal notranslate"><span class="pre">-n</span></code> 将被忽略。如果 <code class="docutils literal notranslate"><span class="pre">-n</span></code> 和 <code class="docutils literal notranslate"><span class="pre">-N</span></code> 参数都不写，则默认打开所有地址名字解析。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-d</span></code> 将指定的数据按有关协议解包输出，如要将tcp 8888端口的流量按http解包，应该写为 <code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">tcp.port==8888,http</span></code> 。可用 <code class="docutils literal notranslate"><span class="pre">tshark</span> <span class="pre">-d</span></code> 列出所有支持的有效选择器。</p></li>
</ul>
</div>
<div class="section" id="id9">
<h3><span class="section-number">10.3.4.4. </span>输出选项<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-w</span> <span class="pre">&lt;outfile&gt;</span></code> 设置raw数据的输出文件。不设置时为stdout</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-F</span> <span class="pre">&lt;output</span> <span class="pre">file</span> <span class="pre">type&gt;</span></code> 设置输出的文件格式，默认是 <code class="docutils literal notranslate"><span class="pre">.pcapng</span></code>，使用 <code class="docutils literal notranslate"><span class="pre">tshark</span> <span class="pre">-F</span></code> 可列出所有支持的输出文件类型</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-V</span></code> 增加细节输出</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-O</span> <span class="pre">&lt;protocols&gt;</span></code> 只显示此选项指定的协议的详细信息</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-P</span></code> 即使将解码结果写入文件中，也打印包的概要信息</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-S</span> <span class="pre">&lt;separator&gt;</span></code> 行分割符</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-x</span></code> 设置在解码输出结果中，每个packet后面以HEX dump的方式显示具体数据</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-T</span> <span class="pre">pdml|ps|text|fields|psml</span></code> 设置解码结果输出的格式，默认为text</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-e</span></code> 如果 <code class="docutils literal notranslate"><span class="pre">-T</span></code> 选项指定， <code class="docutils literal notranslate"><span class="pre">-e</span></code> 用来指定输出哪些字段</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">a|ad|d|dd|e|r|u|ud</span></code> 设置解码结果的时间格式</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-u</span> <span class="pre">s|hms</span></code> 格式化输出秒</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-l</span></code> 在输出每个包之后flush标准输出</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-q</span></code> 结合 <code class="docutils literal notranslate"><span class="pre">-z</span></code> 选项进行使用，来进行统计分析</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-X</span> <span class="pre">&lt;key&gt;:&lt;value&gt;</span></code> 扩展项，lua_script、read_format</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-z</span></code> 统计选项，具体的参考文档</p></li>
</ul>
</div>
<div class="section" id="id10">
<h3><span class="section-number">10.3.4.5. </span>其他选项<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-h</span></code> 显示命令行帮助</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-v</span></code> 显示tshark的版本信息</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sniffing.html" class="btn btn-neutral float-right" title="10.4. 嗅探工具" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="download.html" class="btn btn-neutral float-left" title="10.2. 下载工具" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Surreal

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>